local plr = game.Players.LocalPlayer


if not isfolder("GravyTP") then
	makefolder("GravyTP")
end
if not isfile("GravyTP//games.json") then
	writefile("GravyTP//games.json",game:GetService("HttpService"):JSONEncode({}))
end

local data = game:GetService("HttpService"):JSONDecode(readfile("GravyTP//games.json"))

if not data[tostring(game.GameId)] then
	data[tostring(game.GameId)] = {}
end
writefile("GravyTP//games.json",game:GetService("HttpService"):JSONEncode(data))

local note = function(title,text)
	local NotificationBindable = Instance.new("BindableFunction")
	NotificationBindable.OnInvoke = callback
	game.StarterGui:SetCore("SendNotification",  {
		Title = title;
		Text = text;
		Icon = "";
		Duration = 10;
		Button1 = "Okay";
		Callback = NotificationBindable;
	})
end
note("Keypad 5 hides TPMenu","Right click Item/NPC Button to remove it")

local TPMenu = Instance.new("ScreenGui")
local Items = Instance.new("Frame")
local Title = Instance.new("TextLabel")
local BG = Instance.new("Frame")
local ScrollingFrame = Instance.new("ScrollingFrame")
local UIListLayout = Instance.new("UIListLayout")
local Settings = Instance.new("Frame")
local Title_2 = Instance.new("TextLabel")
local ScrollingFrame_2 = Instance.new("ScrollingFrame")
local UIListLayout_2 = Instance.new("UIListLayout")
local Bring = Instance.new("Frame")
local TextLabel = Instance.new("TextLabel")
local TextButton = Instance.new("TextButton")
local UIStroke = Instance.new("UIStroke",TextButton)
local UIStroke2 = Instance.new("UIStroke",TextButton)
local Filter = Instance.new("Frame")
local TextBox = Instance.new("TextBox")
local UIStroke3 = Instance.new("UIStroke",TextBox)
local Filter_2 = Instance.new("TextLabel")
local NPCs = Instance.new("Frame")
local Title_3 = Instance.new("TextLabel")
local BG_2 = Instance.new("Frame")
local ScrollingFrame_3 = Instance.new("ScrollingFrame")
local UIListLayout_3 = Instance.new("UIListLayout")
local Template = Instance.new("TextButton")
local TextLabel_2 = Instance.new("TextLabel")

ScrollingFrame.AutomaticCanvasSize=Enum.AutomaticSize.XY
ScrollingFrame_2.AutomaticCanvasSize=Enum.AutomaticSize.XY
ScrollingFrame_3.AutomaticCanvasSize=Enum.AutomaticSize.XY

--Properties:

UIStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
UIStroke.Color = Color3.fromRGB(0, 255, 0)
UIStroke.Thickness = 3

UIStroke2.ApplyStrokeMode = Enum.ApplyStrokeMode.Contextual
UIStroke2.Color = Color3.fromRGB(0, 255, 0)
UIStroke2.Thickness = 1
UIStroke2.Name = "UIStroke2"

UIStroke3.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
UIStroke3.Color = Color3.fromRGB(255, 0, 0)
UIStroke3.Thickness = 3

TPMenu.Name = "TPMenu"
TPMenu.Parent = plr:WaitForChild("PlayerGui")
TPMenu.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
TPMenu.ResetOnSpawn = false

Items.Name = "Items"
Items.Parent = TPMenu
Items.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
Items.BorderSizePixel = 0
Items.Position = UDim2.new(0.003, 0, 0.285, 0)
Items.Size = UDim2.new(0.106826469, 0, 0.025925925, 0)

Title.Name = "Title"
Title.Parent = Items
Title.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
Title.BackgroundTransparency = 1.000
Title.Size = UDim2.new(1, 0, 1, 0)
Title.Font = Enum.Font.SourceSansBold
Title.Text = "Items"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextScaled = true
Title.TextSize = 14.000
Title.TextWrapped = true

BG.Name = "BG"
BG.Parent = Items
BG.BackgroundColor3 = Color3.fromRGB(26, 26, 26)
BG.BorderSizePixel = 0
BG.Position = UDim2.new(0, 0, 0.967000008, 0)
BG.Size = UDim2.new(1, 0, 1, 0)

ScrollingFrame.Parent = Items
ScrollingFrame.Active = true
ScrollingFrame.BackgroundColor3 = Color3.fromRGB(26, 26, 26)
ScrollingFrame.BackgroundTransparency = 1
ScrollingFrame.BorderSizePixel = 0
ScrollingFrame.Position = UDim2.new(0, 0, 0.967000008, 0)
ScrollingFrame.Size = UDim2.new(1, 0, 14.25, 0)
ScrollingFrame.ZIndex = 2
ScrollingFrame.ScrollBarThickness = 3

UIListLayout.Parent = ScrollingFrame
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder

Settings.Name = "Settings"
Settings.Parent = TPMenu
Settings.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
Settings.BorderSizePixel = 0
Settings.Position = UDim2.new(0.115, 0, 0.285, 0)
Settings.Size = UDim2.new(0.106826469, 0, 0.025925925, 0)

Title_2.Name = "Title"
Title_2.Parent = Settings
Title_2.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
Title_2.BackgroundTransparency = 1.000
Title_2.Size = UDim2.new(1, 0, 1, 0)
Title_2.Font = Enum.Font.SourceSansBold
Title_2.Text = "Settings"
Title_2.TextColor3 = Color3.fromRGB(255, 255, 255)
Title_2.TextScaled = true
Title_2.TextSize = 14.000
Title_2.TextWrapped = true

ScrollingFrame_2.Parent = Settings
ScrollingFrame_2.Active = true
ScrollingFrame_2.BackgroundColor3 = Color3.fromRGB(26, 26, 26)
ScrollingFrame_2.BackgroundTransparency = 1.000
ScrollingFrame_2.BorderSizePixel = 0
ScrollingFrame_2.Position = UDim2.new(0, 0, 0.967000008, 0)
ScrollingFrame_2.Size = UDim2.new(1, 0, 14.25, 0)
ScrollingFrame_2.ZIndex = 2
ScrollingFrame_2.ScrollBarThickness = 0

UIListLayout_2.Parent = ScrollingFrame_2
UIListLayout_2.SortOrder = Enum.SortOrder.LayoutOrder

Bring.Name = "Bring"
Bring.Parent = ScrollingFrame_2
Bring.BackgroundColor3 = Color3.fromRGB(26, 26, 26)
Bring.BorderSizePixel = 0
Bring.Size = UDim2.new(1, 0, 0.0710596889, 0)

TextLabel.Parent = Bring
TextLabel.AnchorPoint = Vector2.new(0.5, 0.5)
TextLabel.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
TextLabel.BackgroundTransparency = 1.000
TextLabel.Position = UDim2.new(0.5, 0, 0.5, 0)
TextLabel.Size = UDim2.new(0.94, 0, 0.930000007, 0)
TextLabel.Font = Enum.Font.SourceSansBold
TextLabel.Text = "Bring Items"
TextLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
TextLabel.TextScaled = true
TextLabel.TextSize = 14.000
TextLabel.TextWrapped = true
TextLabel.TextXAlignment = Enum.TextXAlignment.Left

TextButton.Parent = Bring
TextButton.AnchorPoint = Vector2.new(0.5, 0.5)
TextButton.BackgroundColor3 = Color3.fromRGB(48, 48, 48)
TextButton.BorderSizePixel = 0
TextButton.Position = UDim2.new(0.920000017, 0, 0.5, 0)
TextButton.Size = UDim2.new(0.0878048763, 0, 0.634857655, 0)
TextButton.Font = Enum.Font.SourceSansBold
TextButton.Text = "✓"
TextButton.TextColor3 = Color3.fromRGB(0, 255, 0)
TextButton.TextScaled = true
TextButton.TextSize = 14.000
TextButton.TextWrapped = true

Filter.Name = "Filter"
Filter.Parent = ScrollingFrame_2
Filter.BackgroundColor3 = Color3.fromRGB(26, 26, 26)
Filter.BorderSizePixel = 0
Filter.Size = UDim2.new(1, 0, 0.0710596889, 0)

TextBox.Parent = Filter
TextBox.AnchorPoint = Vector2.new(0.5, 0.5)
TextBox.BackgroundColor3 = Color3.fromRGB(48, 48, 48)
TextBox.Position = UDim2.new(0.74, 0, 0.5, 0)
TextBox.Size = UDim2.new(0.45, 0, 0.6, 0)
TextBox.Font = Enum.Font.SourceSansBold
TextBox.PlaceholderColor3 = Color3.fromRGB(255, 0, 0)
TextBox.Text = ""
TextBox.TextColor3 = Color3.fromRGB(255, 255, 255)
TextBox.TextScaled = true
TextBox.TextSize = 14.000
TextBox.TextWrapped = true

Filter_2.Name = "Filter"
Filter_2.Parent = Filter
Filter_2.AnchorPoint = Vector2.new(0.5, 0.5)
Filter_2.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
Filter_2.BackgroundTransparency = 1.000
Filter_2.Position = UDim2.new(0.5, 0, 0.5, 0)
Filter_2.Size = UDim2.new(0.94, 0, 0.930000007, 0)
Filter_2.Font = Enum.Font.SourceSansBold
Filter_2.Text = "Filter:"
Filter_2.TextColor3 = Color3.fromRGB(255, 255, 255)
Filter_2.TextScaled = true
Filter_2.TextSize = 14.000
Filter_2.TextWrapped = true
Filter_2.TextXAlignment = Enum.TextXAlignment.Left

NPCs.Name = "NPC's"
NPCs.Parent = TPMenu
NPCs.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
NPCs.BorderSizePixel = 0
NPCs.Position = UDim2.new(0.115, 0, 0.37, 0)
NPCs.Size = UDim2.new(0.106826469, 0, 0.025925925, 0)

Title_3.Name = "Title"
Title_3.Parent = NPCs
Title_3.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
Title_3.BackgroundTransparency = 1.000
Title_3.Size = UDim2.new(1, 0, 1, 0)
Title_3.Font = Enum.Font.SourceSansBold
Title_3.Text = "NPC's"
Title_3.TextColor3 = Color3.fromRGB(255, 255, 255)
Title_3.TextScaled = true
Title_3.TextSize = 14.000
Title_3.TextWrapped = true

BG_2.Name = "BG"
BG_2.Parent = NPCs
BG_2.BackgroundColor3 = Color3.fromRGB(26, 26, 26)
BG_2.BorderSizePixel = 0
BG_2.Position = UDim2.new(0, 0, 0.967000008, 0)
BG_2.Size = UDim2.new(1, 0, 1, 0)

ScrollingFrame_3.Parent = NPCs
ScrollingFrame_3.Active = true
ScrollingFrame_3.BackgroundColor3 = Color3.fromRGB(26, 26, 26)
ScrollingFrame_3.BackgroundTransparency = 1.000
ScrollingFrame_3.BorderSizePixel = 0
ScrollingFrame_3.Position = UDim2.new(0, 0, 0.967000008, 0)
ScrollingFrame_3.Size = UDim2.new(1, 0, 11, 0)
ScrollingFrame_3.ZIndex = 2
ScrollingFrame_3.ScrollBarThickness = 1

UIListLayout_3.Parent = ScrollingFrame_3
UIListLayout_3.SortOrder = Enum.SortOrder.LayoutOrder

Template.Name = "Template"
Template.Parent = TPMenu
Template.BackgroundColor3 = Color3.fromRGB(26, 26, 26)
Template.BorderSizePixel = 0
Template.Size = UDim2.new(1, 0, 0.0710596889, 0)
Template.Visible = false
Template.Text=""

TextLabel_2.Parent = Template
TextLabel_2.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
TextLabel_2.BackgroundTransparency = 1
TextLabel_2.Size = UDim2.new(0.65, 0, 0.987556279, 0)
TextLabel_2.Font = Enum.Font.SourceSansBold
TextLabel_2.Text = "Arrow"
TextLabel_2.TextColor3 = Color3.fromRGB(255, 255, 255)
TextLabel_2.TextScaled = true
TextLabel_2.TextSize = 14.000
TextLabel_2.TextWrapped = true
TextLabel_2.TextXAlignment = Enum.TextXAlignment.Left
TextLabel_2.Position = UDim2.new(.05,0,0,0)

local TextLabel_3 = Instance.new("TextLabel")
TextLabel_3.Parent = Template
TextLabel_3.Font = Enum.Font.SourceSansBold
TextLabel_3.AnchorPoint = Vector2.new(1,.5)
TextLabel_3.Position = UDim2.new(.99,0,.5,0)
TextLabel_3.Text = "AMT: 0"
TextLabel_3.Name = "amt"
TextLabel_3.TextColor3 = Color3.fromRGB(255, 255, 255)
TextLabel_3.TextScaled = true
TextLabel_3.Size = UDim2.new(.3,0,.7,0)
TextLabel_3.BackgroundTransparency = 1

local Refresh = Instance.new("ImageButton")
Refresh.Parent = TPMenu
Refresh.AnchorPoint = Vector2.new(0.5, 0.5)
Refresh.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
Refresh.BackgroundTransparency = 1.000
Refresh.Position = UDim2.new(0.93, 0, 0.5, 0)
Refresh.Size = UDim2.new(0.107, 0, 0.813, 0)
Refresh.Image = "http://www.roblox.com/asset/?id=12938502230"
Refresh.Visible = false

local bring = false

local updateColor = function(button,val)
	button.UIStroke.Color=val and Color3.new(0,255,0) or Color3.fromRGB(255,0,0)
	button.UIStroke2.Color=val and Color3.new(0,255,0) or Color3.fromRGB(255,0,0)
	button.Text=val and "✓" or "X"
	button.TextColor3=val and Color3.fromRGB(0,255,0) or Color3.fromRGB(255,0,0)
end
updateColor(TextButton,bring)

local npcFolder = nil
local addCon = nil
local rmCon = nil

for i,v in pairs(workspace:GetChildren()) do
	local name=string.lower(v.Name)
	if (name=="npcs" or name=="npc" or name=="npc's") and v:IsA("Folder") then
		npcFolder=v break
	end
end

local newFolder = Instance.new("Folder",workspace)
newFolder.Name = "TPMenu Items"

local val=0

local items = {}

local getNum=function(frame,tool)
	tool.Parent = newFolder[frame.Name]
	table.insert(items[frame.Name],tool)
	frame.amt.Text = "AMT: "..#newFolder[frame.Name]:GetChildren()
	if frame.BackgroundColor3 == Color3.fromRGB(255, 0, 55) then
		local sound = Instance.new("Sound",workspace)
		sound.SoundId = "rbxassetid://129653888707716"
		sound.Volume = 1.5
		sound:Play()
		game:GetService("Debris"):AddItem(sound,3)
	end
end

local tpItem = function(child,parent,name)
	local part = nil
	for i,v in pairs(child:GetChildren()) do
		if v:FindFirstChildOfClass("TouchTransmitter") then part=v break end
	end
	if bring then
		for i,v in pairs(child:GetDescendants()) do
			if v:IsA("BasePart") then
				v.Anchored=false
				v.CanCollide=false
			end
		end
		task.spawn(function()
			repeat
				task.spawn(function()
					if plr.Character:FindFirstChild("HumanoidRootPart") and child~=nil and child.PrimaryPart~=nil then
						child.PrimaryPart.CFrame=plr.Character.HumanoidRootPart.CFrame
						child.PrimaryPart.AssemblyLinearVelocity = Vector3.new(0,0,0)
					end
				end)
				task.wait()
			until child.Parent~=parent or child==nil or not child.PrimaryPart
			if child then child:SetAttribute("Teleporting",false) end
		end)
	else
		if child:FindFirstChild("Handle") or part~=nil then
			plr.Character.HumanoidRootPart.CFrame=part.CFrame
		elseif child.PrimaryPart~=nil then
			plr.Character.HumanoidRootPart.CFrame=child.PrimaryPart.CFrame
		end
	end
end

local createItem = function(name,parent,noDupes)
	if noDupes and parent:FindFirstChild(name) then return end
	if items[name]==nil then
		items[name]={}
	end
	local clone=Template:Clone()
	clone.Name=name
	clone.Parent=parent
	clone.TextLabel.Text=string.split(name,"_SpawnModel")[1]
	clone.Visible=true

	parent.CanvasSize=UDim2.new(0,0,0,parent.UIListLayout.AbsoluteContentSize.Y)
	if noDupes then
		clone.TextLabel.AnchorPoint = Vector2.new(1,.5)
		clone.TextLabel.Position = UDim2.new(.71,0,.5,0)
		clone.TextLabel.Size = UDim2.new(.54,0,.85,0)

		local button = TextButton:Clone()
		button.Parent=clone
		button.Position=UDim2.new(.09,0,.5,0)
	end
	wait()
	if parent.CanvasSize.Y.Offset > parent.AbsoluteSize.Y then
		parent.BackgroundTransparency=0
	end
	return clone
end

local buttonCons = {}

local blacklist = {}
local order = 0

local ogOrder = -1
local ogNPCOrder = -1

local buttonFunc = function(button,obj,name,isNPC)
	task.spawn(function()
		if button==nil then return end
		if isNPC then
			ogNPCOrder+=1
		else
			ogOrder+=1
		end
		local curOrder = isNPC and ogNPCOrder or ogOrder
		button.LayoutOrder = curOrder

		local con
		local con2
		if not table.find(data[tostring(game.GameId)],name) and not isNPC then
			table.insert(data[tostring(game.GameId)],name)
			writefile("GravyTP//games.json",game:GetService("HttpService"):JSONEncode(data))
		end
		con = button.MouseButton1Click:Connect(function()

			local child=isNPC and obj or nil
			
			for i = 1,#items[name] do
				local thing = items[name][i]
				if thing:GetAttribute("Teleporting") then
					continue
				else
					child=thing
					child:SetAttribute("Teleporting",true) break
				end
			end

			if child==nil then return end
			if child:FindFirstChild("HumanoidRootPart") then
				plr.Character.HumanoidRootPart.CFrame=child.HumanoidRootPart.CFrame
				return
			end
			tpItem(child,child.Parent,name)
		end)
		local DT = false
		local tapOnce = false
		con2 = button.MouseButton2Click:Connect(function()
			if DT then return end
			if tapOnce then DT=true end
			tapOnce=true
			task.wait(.25)
			if not DT then
				if button.LayoutOrder==curOrder then
					order-=1
					button.LayoutOrder=order
					button.BackgroundColor3 = Color3.fromRGB(255, 0, 55)
					local sound = Instance.new("Sound",workspace)
					sound.SoundId = "rbxassetid://6306609201"
					sound.Volume = 1.5
					sound:Play()
					game:GetService("Debris"):AddItem(sound,3)
				else
					button.LayoutOrder=curOrder
					button.BackgroundColor3 = Color3.fromRGB(26, 26, 26)
					local sound = Instance.new("Sound",workspace)
					sound.SoundId = "rbxassetid://7239001128"
					sound.Volume = 1.5
					sound:Play()
					game:GetService("Debris"):AddItem(sound,3)
				end
			else
				table.insert(blacklist,name)
				local parent=button.Parent
				if isNPC~=true then
					table.remove(buttonCons,table.find(buttonCons,con))
					table.remove(buttonCons,table.find(buttonCons,con2))
				end
				button:Destroy()
				con:Disconnect() con=nil
				con2:Disconnect() con2=nil
				parent.CanvasSize=UDim2.new(0,0,0,parent.UIListLayout.AbsoluteContentSize.Y)
				local sound = Instance.new("Sound",workspace)
				sound.SoundId = "rbxassetid://347611423"
				sound.Volume = 1.5
				sound:Play()
				game:GetService("Debris"):AddItem(sound,3)
			end
			tapOnce=false
		end)
		if isNPC~=true then
			table.insert(buttonCons,con)
			table.insert(buttonCons,con2)
		end
	end)
end

local buttonFunc2 = function(button,name)
	if button==nil then return end
	button=button.TextButton
	local con
	local con2
	local name = name

	local isTrue = false
	updateColor(button,isTrue)
	button.MouseButton1Click:Connect(function()
		isTrue=not isTrue

		updateColor(button,isTrue)

		if isTrue then
			repeat wait()
				task.spawn(function()
					local child=nil
					
					for i = 1,#items[name] do
						local thing = items[name][i]
						if thing:GetAttribute("Teleporting") then
							continue
						else
							child=thing
							child:SetAttribute("Teleporting",true) break
						end
					end

					if child==nil then return end
					tpItem(child,child.Parent,name)
					if button.Parent.Name=="Banknote" then
						if plr.Backpack:FindFirstChild("Banknote") and not plr.Character:FindFirstChild("Banknote") then
							local banknote = plr.Backpack:FindFirstChild("Banknote")
							if banknote then banknote:EquipTool() banknote:Activate() end
						elseif plr.Character:FindFirstChild("Banknote") and plr.Character.Banknote:IsA("Tool") then
							plr.Character.Banknote:Activate()
						end
					end
				end)
			until not isTrue
		end
	end)
end

local function addButtonStuff(name,tool)
	if not ScrollingFrame:FindFirstChild(name) then
		local fold = Instance.new("Folder",newFolder)
		fold.Name = name

		if not table.find(data[tostring(game.GameId)],name) then
			local sound = Instance.new("Sound",workspace)
			sound.SoundId = "rbxassetid://116361357901849"
			sound.Volume = 1
			sound:Play()
			game:GetService("Debris"):AddItem(sound,3)
		end

		local button=createItem(name,ScrollingFrame,true)
		buttonFunc(button,tool,name)
		buttonFunc2(button,name)

		rmCon=fold.ChildRemoved:Connect(function(child)
			table.remove(items[fold.Name],table.find(items[fold.Name],child))
			for i,v in pairs(items[fold.Name]) do
				if v==child then table.remove(items[fold.Name],i) break end
			end
			button.amt.Text = "AMT: "..#fold:GetChildren()
		end)
	end
end

local function refreshItem(tool)
	local found = false
	for i,v in pairs(tool:GetChildren()) do
		if v:FindFirstChildOfClass("TouchTransmitter") then found=v break end
	end
	if not found then return end
	if math.abs(found.CFrame.X)>12000 or math.abs(found.CFrame.Y)>12000 or math.abs(found.CFrame.Z)>12000 then
		tool:Destroy() return
	end
	addButtonStuff(tool.Name,tool)
	getNum(ScrollingFrame[tool.Name],tool)
end

local text = nil

local function checkItem(item)
	if not item.Parent:FindFirstChildOfClass("Humanoid") and not item:IsDescendantOf(newFolder) then
		for i,v in pairs(item:GetDescendants()) do
			if v:IsA("TouchTransmitter") then 
				item.PrimaryPart = v.Parent
				if table.find(blacklist,item.Name) then item:Destroy() return end
				refreshItem(item)
				break 
			end
		end
	end
end

function setSpawns(num)
	if num~=val then return end

	for i,v in pairs(buttonCons) do
		task.spawn(function()
			table.remove(buttonCons,table.find(buttonCons,v))
			v:Disconnect()
			v=nil
		end)
	end
	
	for i = 1,#data[tostring(game.GameId)] do
		addButtonStuff(data[tostring(game.GameId)][i])
	end
	
	workspace.DescendantAdded:Connect(function(item)
		if not item:IsA("Tool") then return end
		local elapsed = 0
		repeat elapsed+=task.wait() if item:FindFirstChildOfClass("Part") or item:FindFirstChildOfClass("MeshPart") or item:FindFirstChildOfClass("UnionOperation") then break end until elapsed>=2
		if elapsed>=5 then return end
		task.wait(.15)
		checkItem(item)
	end)
	
	for i,item in pairs(workspace:GetDescendants()) do
		if not item:IsA("Tool") then continue end
		checkItem(item)
	end
end
setSpawns(val)

TextBox:GetPropertyChangedSignal("Text"):Connect(function()
	for i,v in pairs(ScrollingFrame:GetChildren()) do
		if v:IsA("TextButton") then
			v.Visible=TextBox.Text=="" or string.find(string.lower(v.Name),string.lower(TextBox.Text))
		end
	end
	if ScrollingFrame.CanvasSize.Y.Offset < ScrollingFrame.AbsoluteSize.Y then
		ScrollingFrame.BackgroundTransparency=1
	end
	ScrollingFrame.CanvasSize=UDim2.new(0,0,0,ScrollingFrame.UIListLayout.AbsoluteContentSize.Y)
end)

TextButton.MouseButton1Click:Connect(function()
	bring=not bring
	updateColor(TextButton,bring)
end)

game:GetService("UserInputService").InputBegan:Connect(function(key)
	if key.KeyCode.Name=="KeypadFive" then
		TPMenu.Enabled=not TPMenu.Enabled
	elseif key.KeyCode.Name=="KeypadSeven" then
		Items.Visible=not Items.Visible
		NPCs.Position=UDim2.fromScale(Items.Visible and .115 or .003,NPCs.Position.Y.Scale)
		Settings.Position=UDim2.fromScale(Items.Visible and .115 or .003,Settings.Position.Y.Scale)
	elseif key.KeyCode.Name=="KeypadEight" then
		NPCs.Visible=not NPCs.Visible
	elseif key.KeyCode.Name=="KeypadNine" then
		Settings.Visible=not Settings.Visible
	end
end)

local getNPCs = function()
	if npcFolder~=nil then
		for i,v in pairs(npcFolder:GetChildren()) do
			if v:IsA("Model") and v:FindFirstChild("HumanoidRootPart") then
				local button=createItem(v.Name,ScrollingFrame_3,false)
				button.amt:Destroy()
				button.TextLabel.TextXAlignment = Enum.TextXAlignment.Center
				button.TextLabel.AnchorPoint = Vector2.new(.5,0)
				button.TextLabel.Position = UDim2.new(0.5,0,0,0)
				button.TextLabel.Size = UDim2.new(.95,0,1,0)
				button.Size = UDim2.new(1,0,.091,0)
				buttonFunc(button,v,v.Name,true)
			end
		end
	end
end
getNPCs()

local ref = function(parent)
	local button = Refresh:Clone()
	button.Parent=parent
	button.Visible=true
	button.MouseButton1Click:Connect(function()
		getNPCs()
	end)
end
ref(NPCs)


local elapsed = 0
while true do
	elapsed+=task.wait()
	if elapsed>=5 then
		elapsed=0
		for i,item in pairs(workspace:GetDescendants()) do
			if not item:IsA("Tool") then continue end
			checkItem(item)
		end
	end
end
